INCLUDE(FindwxWidgets)
INCLUDE(FindOpenAL)

SET(wxWidgets_USE_LIBS base core gl media)
FIND_PACKAGE(wxWidgets REQUIRED base core gl media)
INCLUDE(${wxWidgets_USE_FILE})
ADD_DEFINITIONS(-DwxUSE_NO_MANIFEST=1)

FILE(GLOB ANTLR_SRCS antlr/src/*.c)
FILE(GLOB ANTLR_HDRS antlr/include/*.h)
ADD_LIBRARY(antlr STATIC
  ${ANTLR_SRCS}
  ${ANTLR_HDRS}
)

INCLUDE_DIRECTORIES(
antlr/include
${OPENAL_INCLUDE_DIR}
)

INCLUDE(FindJava)

SET(PARSER_SRCS
${CMAKE_CURRENT_SOURCE_DIR}/pcdkParser.c
#${CMAKE_CURRENT_SOURCE_DIR}/pcdkParser.h
${CMAKE_CURRENT_SOURCE_DIR}/pcdkLexer.c
#${CMAKE_CURRENT_SOURCE_DIR}/pcdkLexer.h
)

SET_SOURCE_FILES_PROPERTIES(
${PARSER_SRCS}
PROPERTIES
GENERATED TRUE
LANGUAGE CXX
)

ADD_CUSTOM_COMMAND(OUTPUT ${PARSER_SRCS}
COMMAND ${JAVA_RUNTIME} -cp antlrworks-1.2.3.jar org.antlr.Tool pcdk.g
DEPENDS pcdk.g
WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
COMMENT "antlr'ing grammar"
)

#SET_SOURCE_FILES_PROPERTIES(
#  AppBuilder.rc
#  PROPERTIES
#  COMPILE_DEFINITIONS wxUSE_NO_MANIFEST=1
#)
SOURCE_GROUP("Resource Files" FILES AppBuilder.rc)
SOURCE_GROUP("Grammar" FILES pcdk.g)

INCLUDE_DIRECTORIES(glew/include)
ADD_DEFINITIONS(-DGLEW_STATIC)
ADD_SUBDIRECTORY(glew)

FILE(GLOB AppBuilder_SRCS *.cpp)
FILE(GLOB AppBuilder_HDRS *.h)

ADD_EXECUTABLE(AppBuilder
  ${AppBuilder_SRCS}
  ${AppBuilder_HDRS}
  ${PARSER_SRCS}
  AppBuilder.rc
  pcdk.g
)
TARGET_LINK_LIBRARIES(AppBuilder ${wxWidgets_LIBRARIES} ${OPENAL_LIBRARY} antlr glew)
SET_TARGET_PROPERTIES(AppBuilder
PROPERTIES
WIN32_EXECUTABLE TRUE)
